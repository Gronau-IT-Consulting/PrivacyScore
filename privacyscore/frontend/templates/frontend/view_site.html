{% extends 'frontend/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}Results for {{ site.url }}{% endblock title %}

{% block additional_js %}
  <script src="{% static 'frontend/js/buttons.colVis.js' %}"></script>
  <script src="{% static 'frontend/js/buttons.html5.js' %}"></script>
  <script src="{% static 'frontend/js/pdfmake.min.js' %}"></script>
  <script src="{% static 'frontend/js/jszip.min.js' %}"></script>
  <script src="{% static 'frontend/js/vfs_fonts.js' %}"></script>
  <script src="{% static 'frontend/js/d3.v4.min.js' %}" type="text/javascript"></script>
  <script src="{% static 'frontend/js/diagram.js' %}" type="text/javascript"></script>
{% endblock additional_js %}

{% block additional_css %}
  <style>
  table.dataTable thead .sorting,
table.dataTable thead .sorting_asc,
table.dataTable thead .sorting_desc,
table.dataTable thead .sorting_asc_disabled,
table.dataTable thead .sorting_desc_disabled
 {
    //background-position: left center;
    //padding-left: 20px;
}​
    a {
      color: black;
      text-decoration: none;
    }
    a:hover {
      color: black;
    }

    .description-good {
      color: green;
    }

    .description-neutral {
      color: gray;
    }

    .description-bad, .description-critical {
      color: red;
    }
  </style>
{% endblock additional_css %}


{% block content %}

<div class="row" style="margin-top:40px">
    <div class="col-xs-12">
        <div>
            <h2><small>SHOWING RESULTS FOR</small><br>
                {{ site.url }}
            </h2>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-8">
        
        <div style="background-color: #888; width: 100%; padding: 8px 12px 6px 12px; color: #ccc; font-size: 90%">
            <span>SCAN <span style="color:white">#{{ num_scans }}</span>
            </span>
            <span class="pull-right"><span>LAST SCAN</span>&nbsp; <span style="color: white">{{ site.last_scan.start|date:"Y-m-d @ H:i:s" }} – {{ site.last_scan.end|date:"H:i:s" }}</span></span></div>
        
        <div class="group-box" style="border: 2px solid #888; background: #eee">
            <div class="row">
                <div class="col-xs-6 col-sm-3 text-center bg-warning">
                    1
                </div>
                <div class="col-xs-6 col-sm-3 text-center bg-warning">
                    1
                </div>
                <div class="col-xs-6 col-sm-3 text-center bg-warning">
                    1
                </div>
                <div class="col-xs-6 col-sm-3 text-center bg-warning">
                    1
                </div>
                
            </div>
            
        </div>
    </div>
    <div class="col-sm-4">
        <form method="POST" action="{% url 'frontend:scan_site' site.pk %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-default btn-primary btn-lg" role="button" id="scan_again" style="width:100%; margin-top:5px; margin-bottom:10px">
                {% trans 'Re-scan site now' %}
            </button>
        </form>
    
        <p class="text-center">
            {% if site.last_scan__start and site.last_scan__end_or_null is None %}
                <strong class="text-primary">scheduled for scanning</strong>
            {% else %}
                <small class="text-muted">not scanning at the moment</small>
            {% endif %}
        </p>
    </div>
</div>

<div class="spacer"></div>

<div class="row">
    <div class="col-sm-8">
        <div class="row">
            <div class="col-sm-6">
                <p><small>ANALYZED URL AFTER LOADING:</small><br>
                    <span style="word-wrap: break-word;">
                        {{ res.final_url }}
                    </span></p>
                </p>
            </div>
            <div class="col-sm-6">
                <p><small>ANALYZED MAIL SERVER:</small><br>
                        {{ res.mx_record }}
                </p>
            </div>
            <div class="col-sm-12">
                
                {% for group, descriptions in groups_descriptions %}
                  <h3>{{ group }}</h3>

                  {% for description, classification in descriptions %}
                    <p class="description-{{ classification }}">{{ description }}</p>
                  {% endfor %}
                {% endfor %}
                
                
            </div>
        </div>
        
        
        
        
    </div>
    <div class="col-xs-12 col-sm-4 col-md-4 text-center">
        
        <p class="text-center">
            <small>ON PRIVACYSCORE SINCE</small><br>{{ site.created|date:"Y-m-d" }}
        </p>
        
        
        <div class="group-box" style="padding:5px; margin-bottom: 20px; width:70%; margin-left:auto;margin-right:auto;">
        {% if site.has_screenshot %}
        <img src="{% url 'frontend:site_screenshot' site.pk %}" class="screenshot" style="width:100%; " />
        {% endif %}
        </div>
        
        <p>Referenced in 
            {% blocktrans count counter=scan_lists.count %}
                {{ counter }} list:
            {% plural %}
                {{ counter }} lists:
            {% endblocktrans %}
        </p>
        <div style="width:70%; margin-left:auto;margin-right:auto;">
            {% for list in scan_lists %}
            <a style="white-space: normal"
                type="button" class="btn btn-xs btn-default btn-block"
                href="{% url 'frontend:view_scan_list' list.pk %}">
                {{ list.name }}
            </a>
            {% endfor %}
        </div>
        
    </div>

</div>

{% endblock content %}
